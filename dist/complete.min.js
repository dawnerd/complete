/*!
 * complete - Autocomplete Plugin
 * v0.1.0
 * http://github.com/jgallen23/complete
 * copyright Greg Allen 2013
 * MIT License
*/
!function(a,b){var c=0,d=function(a){this.obj=a};d.prototype.__init=function(a){b.extend(this,this.obj),this.id=c++,this.obj.defaults=this.obj.defaults||{},b.extend(this,this.obj.defaults,a),b("body").trigger("FidelPreInit",this),this.setElement(this.el||b("<div/>")),this.init&&this.init(),b("body").trigger("FidelPostInit",this)},d.prototype.eventSplitter=/^(\w+)\s*(.*)$/,d.prototype.setElement=function(a){this.el=a,this.getElements(),this.delegateEvents(),this.dataElements(),this.delegateActions()},d.prototype.find=function(a){return this.el.find(a)},d.prototype.proxy=function(a){return b.proxy(a,this)},d.prototype.getElements=function(){if(this.elements)for(var a in this.elements){var b=this.elements[a];this[b]=this.find(a)}},d.prototype.dataElements=function(){var a=this;this.find("[data-element]").each(function(c,d){var e=b(d),f=e.data("element");a[f]=e})},d.prototype.delegateEvents=function(){if(this.events)for(var a in this.events){var b=this.events[a],c=a.match(this.eventSplitter),d=c[1],e=c[2],f=this.proxy(this[b]);""===e?this.el.on(d,f):this[e]&&"function"!=typeof this[e]?this[e].on(d,f):this.el.on(d,e,f)}},d.prototype.delegateActions=function(){var a=this;a.el.on("click","[data-action]",function(c){var d=b(this),e=d.attr("data-action");a[e]&&a[e](c,d)})},d.prototype.on=function(a,b){this.el.on(a+".fidel"+this.id,b)},d.prototype.one=function(a,b){this.el.one(a+".fidel"+this.id,b)},d.prototype.emit=function(a,b,c){var d=c?".fidel"+this.id:"";this.el.trigger(a+d,b)},d.prototype.hide=function(){if(this.views)for(var a in this.views)this.views[a].hide();this.el.hide()},d.prototype.show=function(){if(this.views)for(var a in this.views)this.views[a].show();this.el.show()},d.prototype.destroy=function(){this.el.empty(),this.emit("destroy"),this.el.unbind(".fidel"+this.id)},d.declare=function(a){var b=function(a,b){this.__init(a,b)};return b.prototype=new d(a),b},d.onPreInit=function(a){b("body").on("FidelPreInit",function(b,c){a.call(c)})},d.onPostInit=function(a){b("body").on("FidelPostInit",function(b,c){a.call(c)})},a.Fidel=d}(window,window.jQuery||window.Zepto),function(a){a.declare=function(b,c){a.fn[b]=function(){var d,e,f=Array.prototype.slice.call(arguments),g=f.shift();return e=this.each(function(){var e=a(this),h=e.data(b);if(!h){var i=Fidel.declare(c),j=a.extend({},g,{el:e});h=new i(j),e.data(b,h)}"string"==typeof g&&(d=h[g].apply(h,f))}),"undefined"!=typeof d?d:e},a.fn[b].defaults=c.defaults||{}},a.Fidel=window.Fidel}(jQuery),function(a){function b(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}a.declare("autocomplete",{defaults:{search:function(a,b,c){return-1!==a.toLowerCase().indexOf(c.toLowerCase())},listClass:"fidel-autocomplete",suggestionActiveClass:"fidel-autocomplete-active",suggestionClass:"fidel-autocomplete-suggestion",maxHeight:300,minChars:0,zIndex:99999,formatSuggestion:function(a,c){var d="("+b(c)+")";return a.replace(new RegExp(d,"gi"),"<strong>$1</strong>")}},events:{keydown:"keyPressed",keyup:"keyUp",blur:"onBlur"},keyCode:{UP:38,DOWN:40,TAB:9,ENTER:13,ESC:27},init:function(){a(this.el).attr("autocomplete","off"),this.createListHolder(),this.visible=!1,this.currentValue=this.el.value,this.selectedIndex=-1},createListHolder:function(){var b=a(this.el);this.listHolder=a("<div>").addClass(this.listClass).hide().insertAfter(b),this.list=a("<ul>"),this.list.appendTo(this.listHolder),a(this.listHolder).css({width:b.outerWidth(),top:b.position().top+b.outerHeight(),left:b.position().left,"max-height":this.maxHeight,"z-index":this.zIndex}),this.bindEventsList()},bindEventsList:function(){var b=a(this.list),c=this;b.on("mouseover","li",function(a){var b=c._getTarget(a);c.activateSuggestion.apply(c,[b.data("index")])}),b.on("mouseout","li",a.proxy(this.deActivateSuggestion,this)),b.on("click","li",a.proxy(this.selectSuggestion,this))},keyPressed:function(a){switch(a.keyCode){case this.keyCode.UP:this._prevSuggestion();break;case this.keyCode.DOWN:this._nextSuggestion();break;case this.keyCode.ESC:this.el.val(this.currentValue),this.hide();break;case this.keyCode.TAB:case this.keyCode.ENTER:this.selectSuggestion();break;default:return}a.stopImmediatePropagation(),a.preventDefault()},keyUp:function(a){switch(a.keyCode){case this.keyCode.UP:case this.keyCode.DOWN:return}this.valueChanged()},onBlur:function(){a(document).on("click.autocomplete",a.proxy(this.onClickWA,this))},onClickWA:function(b){0===a(b.target).closest("."+this.listClass).length&&(this.hide(),a(document).off("click.autocomplete"))},valueChanged:function(){this.currentValue!==a(this.el).val()&&(this.el.value=a.trim(a(this.el).val()),this.currentValue=this.el.value,this.selectedIndex=-1,this.currentValue.length>this.minChars?this.show():this.hide())},_getSuggestions:function(b){var c=b.toLowerCase(),d=this;return a.grep(this.source,function(a){return d.search(a,b,c)})},_nextSuggestion:function(){var a=this.selectedIndex;!this.visible&&this.currentValue?this.show():a!==this.suggestions.length-1&&this._adjustPosition(a+1)},_prevSuggestion:function(){var a=this.selectedIndex;-1!==a&&this._adjustPosition(a-1)},_adjustPosition:function(b){var c,d,e,f,g=this.activateSuggestion(b),h=a(this.listHolder);g&&(c=g.offsetTop,d=h.scrollTop(),f=a(this.list).children().first().outerHeight(),e=d+this.maxHeight-f,d>c?h.scrollTop(c):c>e&&h.scrollTop(c-this.maxHeight+f),a(this.el).val(this.suggestions[b]))},hide:function(){this.visible=!1,a(this.listHolder).hide()},show:function(){if(this.suggestions=this._getSuggestions(this.currentValue),this.suggestions&&a.isArray(this.suggestions)&&this.suggestions.length){this.visible=!0;var b=this,c=this.currentValue,d=this.suggestionClass,e="";a.each(this.suggestions,function(a,f){e+='<li class="'+d+'" data-index="'+a+'">'+b.formatSuggestion(f,c)+"</li>"}),a(this.list).html(e),a(this.listHolder).show()}else a(this.list).empty(),this.hide()},activateSuggestion:function(b){var c=this.suggestionActiveClass,d=a(this.list);return d.children("."+c).removeClass(c),this.selectedIndex=b,-1!==b&&d.children().length>b?a(d.children().get(b)).addClass(c):void 0},deActivateSuggestion:function(a){this._getTarget(a).removeClass(this.suggestionActiveClass),this.selectedIndex=-1},selectSuggestion:function(){a(this.el).val(this.suggestions[this.selectedIndex]),this.currentValue=this.suggestions[this.selectedIndex],a(this.el).trigger("selected.autocomplete",[this.currentValue]),this.hide()},_getTarget:function(b){return a(b.currentTarget||b.toElement)}})}(jQuery);